<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{block "title" .}}Minecraft Servers{{end}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { background-color: #f8f9fa; }
      .server-card { transition: transform 0.2s; }
      .server-card:hover { transform: translateY(-5px); }
      .status-online { color: #198754; font-weight: bold; }
      .status-offline { color: #dc3545; font-weight: bold; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="/">IEEE Passau MC</a>
        <div class="d-flex">
           {{if .Authenticated}}
            <a href="/admin" class="btn btn-outline-light me-2">Admin</a>
            <a href="/logout" class="btn btn-outline-danger">Logout</a>
           {{else}}
            <a href="/login" class="btn btn-primary">Login</a>
           {{end}}
        </div>
      </div>
    </nav>

    <div class="container">
      {{block "content" .}}{{end}}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Simple client-side status poller
      document.addEventListener("DOMContentLoaded", function() {
        const statusElements = document.querySelectorAll('.server-status-poller');
        statusElements.forEach(el => {
          const serverName = el.dataset.server;
          fetch(`/api/servers/${serverName}/status`)
            .then(r => r.json())
            .then(data => {
              if (data.online) {
                el.innerHTML = `<span class="status-online">Online</span> - ${data.players}/${data.maxPlayers} Players`;
                if(data.motd) {
                  const motdEl = document.getElementById(`live-motd-${serverName}`);
                  if (motdEl) {
                    motdEl.innerText = data.motd;
                    motdEl.style.display = 'block';
                  }
                }
                if(data.samplePlayers && data.samplePlayers.length > 0) {
                    const playerListEl = document.getElementById(`player-list-${serverName}`);
                    if(playerListEl) {
                        const names = data.samplePlayers.map(p => p.name).join(', ');
                        playerListEl.innerHTML = `<strong>Online:</strong> ${names}`;
                    }
                }
              } else {
                el.innerHTML = `<span class="status-offline">Offline</span>`;
              }
            })
            .catch(e => {
              el.innerHTML = `<span class="status-offline">Error</span>`;
            });
        });
      });
    </script>
  </body>
</html>
